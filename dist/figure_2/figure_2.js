var d=Object.defineProperty;var g=(r,t,e)=>t in r?d(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var a=(r,t,e)=>g(r,typeof t!="symbol"?t+"":t,e);import"../modulepreload-polyfill.js";import*as s from"https://cdn.jsdelivr.net/npm/d3@7/+esm";const h={eat:{formatted:"Eat",2015:{SE:1.9,LV:1.3,HU:.9,ES:.3,DE:1.2},2030:{SE:.3,LV:.9,HU:.2,ES:1,DE:1.1},2050:{SE:.1,LV:.3,HU:.2,ES:.3,DE:.05}},sleep:{formatted:"Sleep",2015:{SE:.3,LV:.9,HU:.2,ES:1,DE:1.1},2030:{SE:1.9,LV:1.3,HU:.9,ES:.3,DE:1.2},2050:{SE:.1,LV:.3,HU:.2,ES:.3,DE:.05}},rave:{formatted:"Rave",2015:{SE:.1,LV:.3,HU:.2,ES:.3,DE:.05},2030:{SE:1.9,LV:.5,HU:.4,ES:1.2,DE:.6},2050:{SE:.3,LV:.9,HU:.2,ES:1,DE:1.1}},repeat:{formatted:"Repeat",2015:{SE:1.9,LV:.5,HU:.4,ES:1.2,DE:.6},2030:{SE:.1,LV:.3,HU:.2,ES:.3,DE:.05},2050:{SE:1.9,LV:1.3,HU:.9,ES:.3,DE:1.2}}},p={SE:"Sweden",LV:"Latvia",HU:"Hungary",ES:"Spain",DE:"Germany"},n=["#0ab1b1","#f7941d","#f15a22","#0082c9"];class _{constructor(t,e){a(this,"marginTop",40);a(this,"marginRight",30);a(this,"marginBottom",35);a(this,"marginLeft",55);a(this,"width_factor",.7);a(this,"bar_height",20);a(this,"bar_padding",2);a(this,"bucket_padding",10);this.year=t,this.practices=e,this.v_scale=this.vertical_scale(["Germany","Spain","Hungary","Latvia","Sweden"]),this.h_scale=this.horizontal_scale(2),this.clear(),this.draw(),window.addEventListener("resize",i=>{this.set_width(window.innerWidth*.7)})}clear(){this.svg=s.select("#graph"),this.svg.selectAll("*").remove(),s.select(".fixed-bottom").selectAll("*").remove()}draw(){this.svg.attr("width","100%"),this.svg.attr("height",this.height()),this.svg.append("g").attr("transform",`translate(${this.marginLeft},0)`).call(s.axisLeft(this.v_scale)),s.select(".fixed-bottom").append("g").attr("transform","translate(0, 10)").call(s.axisBottom(this.h_scale)),s.select(".fixed-bottom").append("text").attr("class","x-axis-title").attr("text-anchor","end").attr("x",this.h_scale(20)).attr("y",42).text("Emissions (tCO₂e yr⁻¹ per capita)"),this.practices.forEach(t=>this.draw_practice(t)),this.draw_seeker_line()}data(){let t=[];return this.figure_2.forEach(e=>{this.practices.includes(e.name)&&t.push(e)}),t}height(){return(this.bar_height+this.bucket_padding*2)*5+this.marginBottom+this.marginTop}height(){return 5*this.practices.length*(this.bar_height+this.bar_padding*2)+5*this.bucket_padding*2+this.marginBottom+this.marginTop}width(){let t=document.body.clientWidth;return t>800&&(t=t*this.width_factor),t}horizontal_scale(t){const e=s.scaleLinear();return e.domain([0,t]),e.range([this.marginLeft,this.width()-this.marginRight]),e}vertical_scale(t){const e=s.scaleBand();return e.domain(t),e.range([this.height()-this.marginBottom,this.marginTop]),e}draw_practice(t){this.svg.selectAll(".bar.bar"+t).data(["SE","LV","HU","ES","DE"]).enter().append("rect").attr("class","bar bar"+t).attr("x",this.marginLeft+1).attr("y",this.get_bar_y.bind(this,t)).attr("width",e=>this.h_scale(h[t][this.year][e])-this.marginLeft).attr("height",this.bar_height).attr("fill",n[this.practices.findIndex(e=>e==t)]).on("mouseover",this.cb_bar_mouseover.bind(this,t)).on("mouseout",this.cb_bar_mouseout.bind(this))}draw_seeker_line(){this.svg.append("line").attr("id","seeker_line").attr("x1",-500).attr("x2",-500).attr("y1",this.marginTop).attr("y2",this.height()-this.marginBottom).attr("stroke","black").attr("stroke-width",1)}move_seeker_line(t){s.select("#seeker_line").attr("x1",t).attr("x2",t)}get_bar_y(t,e){const i=this.practices.findIndex(o=>o==t),c=this.v_scale(p[e])+this.bucket_padding+this.bar_padding+i*(this.bar_height+2*this.bar_padding);return isNaN(c)?-100:c}set_width(t){this.h_scale=this.horizontal_scale(2),this.clear(),this.draw()}cb_bar_mouseover(t,e,i){const c=s.select("#tooltip"),o=this.h_scale(h[t][this.year][i]),l=`${h[t].formatted}: ${h[t][this.year][i]} tCO₂e yr⁻¹ per capita`;window.innerWidth<800?c.html(l).style("right",this.marginRight+"px").style("bottom",this.marginBottom+10+"px").style("top","unset").style("left","unset").style("opacity","1").style("position","fixed"):c.html(l).style("left",o+20+"px").style("top",this.get_bar_y(t,i)+"px").style("right","unset").style("bottom","unset").style("opacity",1).style("position","absolute"),this.move_seeker_line(o)}cb_bar_mouseout(){s.select("#tooltip").style("top","-500px").style("opacity",0),this.move_seeker_line(-100)}}class m{constructor(){this.menu=document.getElementById("menu"),this.practices_el=document.getElementById("practices"),this.years_el=document.getElementById("years"),this.year=2015,this.practices=["eat","sleep","rave","repeat"],this.setup_practices(),this.setup_years()}build_graph(){new _(this.year,this.practices),this.setup_practices(),this.setup_years()}setup_practices(){this.practices_el.innerHTML="";for(const[t,e]of Object.entries(h)){const i=document.createElement("div");i.practice=t,i.innerHTML=e.formatted,i.className="practicebutton",i.draggable=!0,this.practices.includes(t)?(i.style["background-color"]=n[this.practices.findIndex(c=>c==t)],i.active=!0):(i.style["background-color"]="beige",i.active=!1),i.onclick=this.cb_practice_onclick.bind(this),this.practices_el.appendChild(i)}}cb_practice_onclick(t){t.target.active?(t.target.active=!1,this.practices.splice(this.practices.indexOf(t.target.practice),1),t.target.style["background-color"]="beige"):(t.target.active=!0,this.practices.push(t.target.practice),t.target.style["background-color"]=n[this.practices.length-1]),this.build_graph()}setup_years(){this.years_el.childNodes.forEach(t=>{t.nodeName=="DIV"&&(t.innerHTML==this.year?t.style["background-color"]="goldenrod":(t.style["background-color"]="white",t.onclick=this.cb_year_onclick.bind(this)))})}cb_year_onclick(t){this.year=t.target.innerHTML,this.build_graph()}select_countries(){for(const t of this.countries_el.getElementsByClassName("countrybutton"))t.active=!0,t.style["background-color"]="#EEAC20";this.build_graph()}deselect_countries(){for(const t of this.countries_el.getElementsByClassName("countrybutton"))t.active=!1,t.style["background-color"]="beige";this.build_graph()}}const u=new m;u.build_graph();
